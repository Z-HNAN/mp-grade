require("../../../common/manifest.js")
require("../../../common/vendor.js")
global.webpackJsonpMpvue([2],{"4A7g":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("5nAL"),i=a.n(o),n=a("4Ynd");new i.a(n.a).$mount()},"4Ynd":function(e,t,a){"use strict";var o=a("tRjl"),i=a("Jb5V");var n=function(e){a("zb5F")},s=a("ybqe")(o.a,i.a,n,null,null);t.a=s.exports},HBbF:function(e,t,a){"use strict";var o=a("r+ip"),i=a("x0EM");var n=function(e){a("XREd")},s=a("ybqe")(o.a,i.a,n,"data-v-4284e64d",null);t.a=s.exports},Jb5V:function(e,t,a){"use strict";var o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"content"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoaded,expression:"!isLoaded"}],staticClass:"weui-loadmore"},[a("i",{staticClass:"weui-loading"}),e._v(" "),a("p",{staticClass:"weui-loadmore__tips"},[e._v(e._s(e.renderTips))])],1),e._v(" "),e.isLoaded?a("div",{staticClass:"show-wrap"},[a("movable-area",{staticClass:"movable-area",style:"display:"+e.movableViewInfo.showClass+"; height: "+e.pageInfo.moveAbleHeight+"px; ",attrs:{mpcomid:"1"}},[a("movable-view",{staticClass:"list-row movable-row",style:"height:"+e.pageInfo.rowHeight+"rpx;",attrs:{"out-of-bounds":"true",direction:"vertical",damping:"999",y:e.movableViewInfo.y,mpcomid:"0"}},[a("div",{staticClass:"weui-cell weui-cell_access move-item-wrap",attrs:{eventid:"0"},on:{touchstart:e.handleDragStart,touchmove:e.handleDragMove,touchend:e.handleDragEnd}},[a("div",{staticClass:"weui-cell__bd weui-cell_primary"},[a("span",[e._v(e._s(e.movableViewInfo.gradeName))]),e._v(" "),a("span",[e._v(e._s(e.movableViewInfo.gradeTotal))])]),e._v(" "),a("span",{staticClass:"weui-cell__ft iconfont icon-move"}),e._v(" "),a("span",{staticClass:"weui-cell__ft iconfont icon-delete"})])])],1),e._v(" "),e.isRender?a("div",{staticClass:"grade-category-wrap"},[e._l(e.categoryDataList,function(t,o){return a("div",{key:o,staticClass:"box-wrap",class:{"category-active":e.currentCategoryIndex===o}},[a("grade-category",{attrs:{categoryData:t,shadowColor:e.getColorRandom(o),showIndex:o,showDetail:e.currentCategoryIndex===o,eventid:"1_"+o,mpcomid:"2_"+o},on:{readyMove:e.handleRandyMoveItem,readyFreshByRemove:e.handleRemoveFresh,updateFresh:e.handleUpdateFresh}})],1)}),e._v(" "),a("div",{staticClass:"box-wrap",class:{"category-active":-1===e.currentCategoryIndex}},[a("grade-category",{attrs:{categoryData:e.defaultData,shadowColor:"#d4237a",showIndex:"-1",eventid:"2",mpcomid:"3"},on:{readyMove:e.handleRandyMoveItem,readyFreshByRemove:e.handleRemoveFresh}})],1)],2):e._e()],1):e._e(),e._v(" "),a("transition",{attrs:{name:"go-new",mpcomid:"4"}},[a("div",{staticClass:"btn-icon refresh",class:{circleing:!1===e.isLoaded},attrs:{eventid:"3"},on:{tap:e.handRefresh}},[a("img",{attrs:{src:"/static/images/refresh.png",alt:""}})])])],1)},staticRenderFns:[]};t.a=o},XREd:function(e,t){},"r+ip":function(e,t,a){"use strict";var o=a("mvHQ"),i=a.n(o);t.a={props:["categoryData","shadowColor","showDetail","showIndex"],data:function(){return{isShowCategory:!1,isShowModal:!1,isHidden:!1,isDefaultPackage:-1==this.showIndex,packageTitle:this.categoryData.packageTitle,packageRank:this.categoryData.rank}},computed:{},methods:{handleShowCategory:function(){this.isShowCategory=!this.isShowCategory},handleMoveItem:function(e,t){this.$emit("readyMove",t.y,this.showIndex,e)},handleDeleteItem:function(e,t,a){var o=this;wx.showModal({title:"删除试卷",content:"是否删除?"+e.gradeName,success:function(a){a.confirm?(wx.showToast({icon:"loading",title:"删除中......",duration:5e3}),wx.cloud.callFunction({name:"removeGrade",data:{packageId:o.categoryData._id,gradeId:e._id}}).then(function(){wx.showToast({icon:"success",title:"已删除",duration:800}),o.categoryData.grades.splice(t,1),o.categoryData=JSON.parse(i()(o.categoryData)),o.$emit("readyFreshByRemove",o.categoryData._id)})):a.cancel}})},handleRemovePackage:function(){var e=this;wx.showModal({title:"删除试卷包",content:"是否删除?"+e.packageTitle,success:function(t){t.confirm?(e.isHidden=!0,wx.cloud.callFunction({name:"removePaperPackage",data:{paperId:e.categoryData._id}}).then(function(){return e.$emit("updateFresh")})):t.cancel}})},handleCancel:function(){this.isShowModal=!1},handleConfirm:function(){this.isShowModal=!1,wx.cloud.database().collection("paperPackage").doc(this.categoryData._id).update({data:{title:this.packageTitle,rank:this.packageRank}}),this.$emit("updateFresh")}},beforeMount:function(){}}},tRjl:function(e,t,a){"use strict";var o=a("mvHQ"),i=a.n(o),n=a("//Fk"),s=a.n(n),r=a("Dd8w"),c=a.n(r),d=a("HBbF"),l=a("NYxO");t.a={data:function(){return{isLoaded:!0,isRender:!0,colorList:["#e36868","#94b38f","#bfad86","#a3bac2"],activeColor:"#f5be33",currentCategoryIndex:"",movableViewInfo:{_id:"",y:0,showClass:"none",srcCategoryIndex:"",gradeTotal:"",gradeName:""},pageInfo:{rowHeight:50,moveAbleHeight:100},categoryPositionList:[],categoryDataList:[],defaultData:{}}},computed:c()({},Object(l.c)(["gradeNameList","userinfo"]),{renderTips:function(){return this.$store.getters.getRandomTip()}}),methods:c()({},Object(l.b)(["getUserinfo","getTipsList","getPaperPackage","getUserGradeList"]),{getColorRandom:function(e){return this.colorList[e%this.colorList.length]},handRefresh:function(){var e=this;console.log(this.$store.state.paperPackage),console.log(this.$store.getters.getPaperPackage());var t=void 0;this.isLoaded=!1,this.categoryDataList=this.$store.getters.getPaperPackage(),this.defaultData=this.$store.getters.getDefaultPaper(),t=setTimeout(function(){e.isLoaded=!0,clearTimeout(t)},150)},getNowFormatDate:function(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,o=e.getDate();return a>=1&&a<=9&&(a="0"+a),o>=0&&o<=9&&(o="0"+o),t+"-"+a+"-"+o},handleUpdateFresh:function(){var e=this;return new s.a(function(t){e.getPaperPackage().then(function(){return e.getUserinfo()}).then(function(){e.handRefresh(),t()})})},handleRemoveFresh:function(e){var t=this;new s.a(function(a){e?t.getPaperPackage().then(function(){t.categoryDataList=t.$store.getters.getPaperPackage(),a()}):t.getUserinfo().then(function(){t.defaultData=t.$store.getters.getDefaultPaper(),a()})}).then(function(){t.getUserGradeList()})},addCategory:function(){var e=this,t=wx.cloud.database();t.command;t.collection("paperPackage").add({data:{title:"新创建的试卷包",papers:[],rank:0,createdDate:this.getNowFormatDate()},success:function(t){e.isLoaded=!1,e.addPaperPakageToUser(t._id).then(function(t){return e.getUserinfo()}).then(function(t){e.handleUpdateFresh().then(function(){e.isLoaded=!0,wx.showToast({title:"已成功创建！"})})})}})},addPaperPakageToUser:function(e){var t=this,a=wx.cloud.database(),o=a.command;return new s.a(function(i,n){a.collection("userInfo").doc(t.userinfo._id).update({data:{paperPackage:o.push([e])},complete:function(e){i()}})})},openModal:function(){this.isShowModal=!this.isShowModal},handleRandyMoveItem:function(e,t,a){this.movableViewInfo.y=e-this.pageInfo.rowHeight,this.movableViewInfo._id=a._id,this.movableViewInfo.gradeTotal=a.gradeTotal,this.movableViewInfo.gradeName=a.gradeName,this.movableViewInfo.showClass="inline",this.movableViewInfo.srcCategoryIndex=t},handleDragStart:function(e){var t=this;wx.createSelectorQuery().selectAll(".box-wrap").boundingClientRect(function(e){t.categoryPositionList=e.map(function(e){return{top:e.top,bottom:e.bottom}})}).exec()},handleDragMove:function(e){var t=e.clientY,a=this.categoryPositionList.findIndex(function(e){return t>=e.top&&t<=e.bottom});-1!==a&&(a<this.categoryDataList.length?this.currentCategoryIndex=a:this.currentCategoryIndex=-1)},handleDragEnd:function(e){var t=this,a=void 0,o=void 0;-1==this.movableViewInfo.srcCategoryIndex?(a=this.defaultData.grades.findIndex(function(e){return e._id===t.movableViewInfo._id}),o=this.defaultData.grades.splice(a,1)):(a=this.categoryDataList[this.movableViewInfo.srcCategoryIndex].grades.findIndex(function(e){return e._id===t.movableViewInfo._id}),o=this.categoryDataList[this.movableViewInfo.srcCategoryIndex].grades.splice(a,1)),-1===this.currentCategoryIndex?this.defaultData.grades.push(o[0]):this.categoryDataList[this.currentCategoryIndex].grades.push(o[0]),this.$set(this,"categoryDataList",JSON.parse(i()(this.categoryDataList))),this.$set(this.defaultData,"grades",JSON.parse(i()(this.defaultData.grades))),this.handRefresh(),new s.a(function(e,a){-1==t.movableViewInfo.srcCategoryIndex?wx.cloud.callFunction({name:"movePaperToPackage",data:{srcPackage:-1,destPackage:t.categoryDataList[t.currentCategoryIndex]._id,paperId:t.movableViewInfo._id}}).then(e):-1==t.currentCategoryIndex?wx.cloud.callFunction({name:"movePaperToPackage",data:{srcPackage:t.categoryDataList[t.movableViewInfo.srcCategoryIndex]._id,destPackage:-1,paperId:t.movableViewInfo._id}}).then(e):wx.cloud.callFunction({name:"movePaperToPackage",data:{srcPackage:t.categoryDataList[t.movableViewInfo.srcCategoryIndex]._id,destPackage:t.categoryDataList[t.currentCategoryIndex]._id,paperId:t.movableViewInfo._id}}).then(e)}).then(function(){t.getUserinfo().then(function(){return t.defaultData=t.$store.getters.getDefaultPaper()}),t.getPaperPackage().then(function(){return t.categoryDataList=t.$store.getters.getPaperPackage()})}),this.currentCategoryIndex="",this.movableViewInfo={_id:"",y:0,showClass:"none",srcCategoryIndex:"",gradeTotal:"",gradeName:""}}}),components:{gradeCategory:d.a},beforeMount:function(){this.categoryDataList=this.$store.getters.getPaperPackage(),this.defaultData=this.$store.getters.getDefaultPaper()},mounted:function(){var e=this;wx.createSelectorQuery().select("#content").boundingClientRect(function(t){e.pageInfo.moveAbleHeight=t.height}).exec()},updated:function(){var e=this;wx.createSelectorQuery().select("#content").boundingClientRect(function(t){t&&(e.pageInfo.moveAbleHeight=t.height)}).exec()}}},x0EM:function(e,t,a){"use strict";var o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isHidden,expression:"!isHidden"}],staticClass:"shadow-wrap",style:"box-shadow:-28rpx 0 0 0 "+e.shadowColor+", 0 8rpx 16rpx 0 rgba(168,116,86,0.2);"},[a("div",{staticClass:"weui-panel"},[a("div",{staticClass:"weui-cell_access weui-panel__hd",attrs:{eventid:"2"},on:{tap:e.handleShowCategory}},[a("span",{staticClass:"head-title"},[e._v(e._s(e.categoryData.packageTitle))]),e._v(" "),a("span",{staticClass:"head-btn",class:{default:!0===e.isDefaultPackage}},[e.isDefaultPackage?e._e():a("span",{staticClass:"op-icon iconfont icon-edit",attrs:{eventid:"0"},on:{tap:function(t){e.isShowModal=!0}}}),e._v(" "),e.isDefaultPackage?e._e():a("span",{staticClass:"op-icon iconfont icon-delete",attrs:{eventid:"1"},on:{tap:e.handleRemovePackage}}),e._v(" "),a("span",{staticClass:"op-icon iconfont icon-detail"})])]),e._v(" "),e.isShowCategory?a("div",{staticClass:"weui-panel__bd"},[a("div",{staticClass:"weui-media-box weui-media-box_small-appmsg"},[e.isDefaultPackage?e._e():a("div",{staticClass:"weui-cellgrade-item-wrap grade-rank"},[a("div",{staticClass:"weui-cell__bd weui-cell_primary"},[a("p",{staticClass:"title"},[e._v("总排名: "+e._s(e.categoryData.rank)+" ")])],1)]),e._v(" "),a("div",{staticClass:"weui-cells"},[a("div",{staticClass:"box-item-wrap"},e._l(e.categoryData.grades,function(t,o){return a("div",{key:o,staticClass:"weui-cell grade-item-wrap"},[a("div",{staticClass:"weui-cell__bd weui-cell_primary grade-item"},[a("p",{staticClass:"title grade-name"},[e._v(e._s(t.gradeName)+" "+e._s(t.gradeTotal)+" "+e._s(t.gradeTitle))])],1),e._v(" "),a("span",{staticClass:"weui-cell__ft iconfont icon-move",attrs:{eventid:"3_"+o},on:{tap:function(a){e.handleMoveItem(t,a)}}}),e._v(" "),a("span",{staticClass:"weui-cell__ft iconfont icon-delete",attrs:{eventid:"4_"+o},on:{tap:function(a){e.handleDeleteItem(t,o,a)}}})])}))])])]):e._e()]),e._v(" "),a("modal",{directives:[{name:"show",rawName:"v-show",value:e.isShowModal,expression:"isShowModal"}],attrs:{id:"modal",title:"更改试卷分类信息","confirm-text":"提交","cancel-text":"取消",eventid:"7",mpcomid:"0"},on:{cancel:e.handleCancel,confirm:e.handleConfirm}},[e._v("  \n      分类名称： "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.packageTitle,expression:"packageTitle"}],staticClass:"modal-input",attrs:{type:"text",eventid:"5"},domProps:{value:e.packageTitle},on:{input:function(t){t.target.composing||(e.packageTitle=t.target.value)}}}),e._v("\n      排名： "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.packageRank,expression:"packageRank"}],staticClass:"modal-input",attrs:{type:"number",eventid:"6"},domProps:{value:e.packageRank},on:{input:function(t){t.target.composing||(e.packageRank=t.target.value)}}})])],1)},staticRenderFns:[]};t.a=o},zb5F:function(e,t){}},["4A7g"]);