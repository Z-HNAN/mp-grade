require("../../common/manifest.js")
require("../../common/vendor.js")
global.webpackJsonpMpvue([7],{"/y3q":function(e,t,a){"use strict";var i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"body"},[a("div",{staticClass:"school-wrap"},[a("div",{staticClass:"school-img"},[a("div",{staticClass:"img-content"},[a("img",{attrs:{src:e.backgroundImg,alt:""}})])]),e._v(" "),a("div",{staticClass:"school-space"},[a("span",{staticClass:"count"},[e._v(e._s(e.countDay)+"天")]),e._v(" "),a("span",{staticClass:"school weui-cell_link",attrs:{eventid:"0"},on:{tap:e.uploadImg}},[e._v("点击更换背景墙")])])]),e._v(" "),e.showCropper?a("image-cropper",{attrs:{id:"image-cropper",limit_move:!0,disable_ratio:!0,disable_rotate:!0,width:"340",height:"190",imgSrc:e.backgroundImgSrc,export_scale:1,eventid:"1",mpcomid:"0"},on:{confirmCut:e.handleConfirmCut,cancelCut:e.handleCancelCut,load:e.cropperload,imageload:e.loadimage,tapcut:e.clickcut}}):e._e(),e._v(" "),a("div",{staticClass:"userinfo"},[a("div",{staticClass:"weui-media-box weui-media-box_appmsg"},[a("div",{staticClass:"weui-media-box__hd"},[a("img",{staticClass:"weui-media-box__thumb",attrs:{src:e.currentUserInfo.avatarUrl}})]),e._v(" "),a("div",{staticClass:"weui-media-box__bd"},[a("h4",{staticClass:"weui-media-box__title"},[e._v(e._s(e.currentUserInfo.nickName))])],1)])]),e._v(" "),a("div",{staticClass:"setting"},[a("div",{staticClass:"setting-item weui-cell"},[a("div",{staticClass:"weui-cell__hd"},[a("label",{staticClass:"grade-input-head weui-label"},[e._v("考卷类型")])],1),e._v(" "),a("picker",{attrs:{mode:"multiSelector",range:e.parperTypeList,"range-key":"name",eventid:"2"},on:{change:e.handleMultiPickerChange,columnchange:e.handleMultiPickerColumnChange}},[a("view",{staticClass:"picker weui-cell__bd link_text"},[e._v(e._s(e.showPaperType))])])],1),e._v(" "),a("div",{staticClass:"setting-item setting-parper weui-cell"},[a("div",{staticClass:"weui-cell__hd"},[a("label",{staticClass:"grade-input-head weui-label"},[e._v("绑定学校")])],1),e._v(" "),a("div",{staticClass:"weui-cell__bd",attrs:{eventid:"3"},on:{tap:e.handleBindSchool}},[a("span",[e._v("点击绑定")])])]),e._v(" "),a("div",{staticClass:"setting-item setting-parper weui-cell"},[a("div",{staticClass:"weui-cell__hd"},[a("label",{staticClass:"grade-input-head weui-label"},[e._v("查看教程")])],1),e._v(" "),a("div",{staticClass:"weui-cell__bd",attrs:{eventid:"4"},on:{tap:e.goGuidePage}},[a("span",[e._v("点击查看")])])]),e._v(" "),a("div",{staticClass:"about weui-cell"},[a("div",{attrs:{eventid:"5"},on:{tap:e.goAbout}},[a("span",{staticClass:"iconfont icon-about"}),e._v(" "),a("span",{staticClass:"tips"},[e._v("关于我们")])])]),e._v(" "),a("modal",{directives:[{name:"show",rawName:"v-show",value:e.isShowModal,expression:"isShowModal"}],attrs:{id:"modal",title:"绑定学校","confirm-text":"提交","cancel-text":"取消",eventid:"8",mpcomid:"1"},on:{cancel:e.handleCancel,confirm:e.handleConfirm}},[a("p",[e._v("注意:绑定学校功能，需学校教务处申请接通后，方可正常使用，与学生自己管理不造成冲突，并且可由教务处导入成绩。(^_^可在关于我们-联系作者处申请)")]),e._v(" "),a("span",[e._v("学校邀请码： ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.inviteCode,expression:"inviteCode"}],staticClass:"modal-input",attrs:{type:"text",eventid:"6"},domProps:{value:e.inviteCode},on:{input:function(t){t.target.composing||(e.inviteCode=t.target.value)}}}),e._v(" "),a("span",[e._v("学号： ")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.studentId,expression:"studentId"}],staticClass:"modal-input",attrs:{type:"text",eventid:"7"},domProps:{value:e.studentId},on:{input:function(t){t.target.composing||(e.studentId=t.target.value)}}})],1)],1)],1)},staticRenderFns:[]};t.a=i},Es0M:function(e,t){},nU8l:function(e,t,a){"use strict";var i=a("scqF"),n=a("/y3q");var s=function(e){a("Es0M")},o=a("ybqe")(i.a,n.a,s,"data-v-0a34c903",null);t.a=o.exports},scqF:function(e,t,a){"use strict";var i=a("Dd8w"),n=a.n(i),s=a("NYxO");t.a={data:function(){return{showCropper:!1,backgroundImgSrc:"",countDay:"",parperTypeList:[[],[]],showPaperType:"",currentUserInfo:{},isShowModal:!1,inviteCode:"",studentId:""}},computed:n()({},Object(s.c)(["userinfo"]),{backgroundImg:function(){return this.userinfo.backgroundImg?this.userinfo.backgroundImg:"cloud://grade-production-b34221.6772-grade-production-b34221/background-img/default.jpg"}}),methods:n()({},Object(s.b)(["getNameGradeList","getUserinfo","getUserGradeList"]),{handleMultiPickerChange:function(e){var t=this,a=e.target.value[0],i=this.parperTypeList[0][a].id,n=this.parperTypeList[0][a].name,s=e.target.value[1],o=this.parperTypeList[1][s].value,r=this.parperTypeList[1][s].name;wx.showModal({title:"注意",content:"是否修改为【"+n+"  "+r+"】",success:function(e){(wx.showLoading({title:"修改中"}),e.confirm)&&(wx.cloud.database().collection("userInfo").doc(t.userinfo._id).update({data:{gradeId:i,gradeType:o}}).then(function(){return t.getUserinfo()}).then(function(){return t.getNameGradeList()}).then(function(){wx.hideLoading(),wx.showToast({title:"修改完毕"})}),t.showPaperType=n+"  "+r)}})},handleMultiPickerColumnChange:function(e){var t=this,a=e.target.column;if(0===a){var i=this.parperTypeList[0][e.target.value].id;this.getPaperTypeByGradeId(i,function(e){t.parperTypeList=[t.parperTypeList[0],e]})}else if(1===a)return},getUserInfo:function(){var e=this;wx.getUserInfo({success:function(t){e.currentUserInfo=t.userInfo}})},goAbout:function(){wx.navigateTo({url:"/pages/about/main"})},handleBindSchool:function(){this.isShowModal=!this.isShowModal},handleCancel:function(){this.isShowModal=!1},handleConfirm:function(){var e=this;wx.cloud.callFunction({name:"bindSchool",data:{inviteCode:this.inviteCode,studentId:this.studentId}}).then(function(t){"success"===t.result.message?(wx.showToast({title:"绑定成功"}),e.isShowModal=!1):wx.showToast({title:"绑定失败,请检查邀请码是否正确",icon:"none"})})},handleClearUser:function(){wx.showModal({title:"警告",content:"此操作不可逆，为保证您的隐私，我们将您清除所有数据",success:function(e){e.confirm&&wx.showToast({title:"已经全部清除！"})}})},getPaperTypeByGradeId:function(e,t){var a=[];wx.cloud.database().collection("paperType").where({id:e}).get().then(function(e){var i=e.data[0];i.humanities&&a.push({name:"文科",value:"humanities"}),i.science&&a.push({name:"理科",value:"science"}),0===a.length&&a.push({name:"全部",value:"normal"}),t(a)})},goGuidePage:function(){wx.navigateTo({url:"/pages/guide/main"})},getCountDay:function(){var e=this;wx.cloud.callFunction({name:"countDown",data:{}}).then(function(t){return e.countDay=t.result})},uploadImg:function(){var e=this;wx.showActionSheet({itemList:["从相册中选择","拍照"],itemColor:"#999",success:function(t){0==t.tapIndex?e.chooseWxImage("album"):1==t.tapIndex&&e.chooseWxImage("camera")}})},chooseWxImage:function(e){var t=this;wx.chooseImage({sizeType:["original","compressed"],sourceType:[e],success:function(e){t.showCropper=!0,t.backgroundImgSrc=e.tempFilePaths[0]}})},handleConfirmCut:function(e){var t=this;this.showCropper=!1,console.log(e),wx.showToast({icon:"loading",title:"上传中..."}),wx.cloud.deleteFile({fileList:[this.userinfo.backgroundImg]}).then(function(){wx.cloud.uploadFile({cloudPath:"background-img/"+Math.random().toString(16).substr(2)+".png",filePath:e.mp.detail.url,success:function(e){wx.hideToast(),t.$store.dispatch("updateBackgroundImg",e.fileID),wx.cloud.database().collection("userInfo").doc(t.userinfo._id).update({data:{backgroundImg:e.fileID}})},fail:function(e){return wx.showToast({title:"提示",content:"上传失败"})},complete:function(){return wx.hideToast()}})})},handleCancelCut:function(){this.showCropper=!1}}),created:function(){},beforeMount:function(){this.getUserInfo(),this.getCountDay()},mounted:function(){var e=this,t=wx.cloud.database();t.collection("paperType").get().then(function(t){var a=t.data.map(function(e){return{name:e.typeName,id:e.id}});e.parperTypeList=[a],e.getPaperTypeByGradeId(e.parperTypeList[0][0].id,function(t){if(e.parperTypeList=[e.parperTypeList[0],t],e.userinfo.gradeId){var a=e.parperTypeList[0].find(function(t){return t.id==e.userinfo.gradeId}),i="全部";"science"===e.userinfo.gradeType?i="理科":"humanities"===e.userinfo.gradeType&&(i="文科"),e.showPaperType=a.name+"  "+i}else e.showPaperType=e.parperTypeList[0][0].name+"  "+e.parperTypeList[1][0].name})}),t.collection("studentSchoolMap").where({_openid:this.userinfo._openid}).get().then(function(t){if(t.data[0]){var a=t.data[0];e.inviteCode=a.inviteCode,e.studentId=a.studentId}})}}},usrL:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("5nAL"),n=a.n(i),s=a("nU8l");new n.a(s.a).$mount()}},["usrL"]);